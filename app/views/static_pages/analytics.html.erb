<h1><b>Analytics Generation Module</b></h1>
<div class="jumbotron">
<%= search_form_for @q, url: search_analytics_static_pages_path do |f| %>
	<div class="row">
  		<div class="col-xs-4">
  			<%= f.input :status_eq, :collection => ProjectStatus.all, :label_method => :description, :include_blank => true, :label => "Project Status", required: false %>
  		</div>
  		<div class="col-xs-4">
  			<%= f.input :timeline_actual_end_gteq, :label => "From Completion Date:", :start_year => Date.today.year, :end_year => 1900, :include_blank => true, :as => :date_picker, :placeholder => "DD/MM/YYYY", required: false %>
  		</div>
  		<div class="col-xs-4">
  			<%= f.input :timeline_actual_end_lteq, :label => "To Completion Date:", :start_year => Date.today.year, :end_year => 1900, :include_blank => true, :as => :date_picker, :placeholder => "DD/MM/YYYY", required: false %>
  		</div>
  	</div>
  	<div class="row">
  		<div class="col-xs-6">
  			<%= f.input :university_id_in, :collection => University.all.order(:university_name), :label_method => :university_name, :include_blank => true, :label => "Project of:", required: false %>
  		</div>
  		<div class="col-xs-6">
  			<%= f.input :fund_sources_id_in, :collection => FundSource.all.order(:source_name), :label_method => :source_name, :include_blank => true, :label => "Source of fund/s:", required: false %>
  		</div>
  	</div>
  	
  <%= f.button :submit, :class => "btn btn-success pull-right" %>
<% end %>
</div>

<div class="col-xs-12">
	<div class="panel panel-info">
		<div class="panel-heading">
			<h3>Number of Projects: <%= @output.count %></h3>	
		</div>
		<div class="panel-body">

			<b><u>Sorted by CU:</u></b><br>
			<% @group_by_cu = @output.group_by { |x| x[:university_id] }%>
			<%= pie_chart @group_by_cu.map {|k,v| [University.find(k).university_name, v.length]} %>

			<b><u>Sorted by status:</u></b><br>
			<% @group_by_status = @output.group_by { |x| x[:status] }%>
			<%= pie_chart @group_by_status.map {|k,v| [(ProjectStatus.find(k).description rescue nil), v.length]} %>

			<b><u>Sorted by Project Classification:</u></b><br>
			<% @group_by_pc = @output.group_by { |x| x[:classification] }%>
			<%= pie_chart @group_by_pc.map {|k,v| [(ProjectClassification.find(k).description rescue nil), v.length]} %>

			<b><u>Sorted by Fund Source:</u></b><br>
			<%= pie_chart @output.joins(:fund_sources).group("fund_sources.source_name").count %>

			<b><u>Sorted by Fund Source Classification:</u></b><br>
			<%= pie_chart @output.joins(:fund_sources).group("fund_sources.fund_source_classification").count %>
			
			<b><u>Sorted by Budget:</u></b><br>
			<b><li>Total (PhP): <%= number_with_precision( @output.sum(:financial_budget), precision: 2, delimiter: ',' ) %></li></b><br>
			<%= pie_chart @output.group(:project_name).order('financial_budget desc').sum(:financial_budget) %>
			<%= render 'shared/projects_list' %>
		</div>
	</div>
</div>

